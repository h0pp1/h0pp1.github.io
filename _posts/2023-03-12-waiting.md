---
title: '[Hackthebox] Waiting'
author: hoppi
date: 2023-03-12 22:04:00 + 0000
categories: [Mobile]
tags: [mobile, reversing]
---

ê±°ì˜ ë‘ ë‹¬ ë§Œì— ëª¨ë°”ì¼ ë¶„ì•¼ì—ì„œ ìƒˆë¡œìš´ ë¬¸ì œê°€ ë‚˜ì™€ì„œ í•œ ë²ˆ í’€ì–´ë³´ì•˜ìŠµë‹ˆë‹¤.
<br/>

**í‚¤ì›Œë“œ: Mobile, Reversing**

![description](../../../assets/img/2023-03-12/description.png){: w="700" h="350" }  
<br/>

# ë¶„ì„
***
ì¼ë‹¨ í›„í‚¹ì„ ê±¸ê²Œë˜ë©´ ì•±ì´ `crash`ê°€ ë‚˜ë©´ì„œ êº¼ì§‘ë‹ˆë‹¤. ìŠ¤ë§ë¦¬ ì½”ë“œ íŒ¨ì¹˜ë„ ëª‡ë²ˆ í•´ë³´ê³  ì•ˆë¼ì„œ ì´ë ‡ê²Œ í•˜ëŠ”ê²Œ ì•„ë‹ˆêµ¬ë‚˜ë¼ëŠ” íŒë‹¨ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì½”ë“œë¥¼ ì¢€ ë” ì‚´í´ë³´ì•˜ì£ .  
ì•± íŒ¨í‚¤ì§€ ë””ë ‰í† ë¦¬ ì•ˆì— `Secret`ì´ë¼ëŠ” ìˆ˜ìƒí•œ í´ë˜ìŠ¤ê°€ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ì„œ `getdxXEPMNe`ë¼ëŠ” ë©”ì„œë“œë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤.  
![secret](../../../assets/img/2023-03-12/secret.png){: w="700" h="350" }  
<br/>

ê·¸ë˜ì„œ ë°”ë¡œ `libsecret.so`íŒŒì¼ì„ ì—´ì–´ë³´ì•˜ìŠµë‹ˆë‹¤. `getdxXEPMNe`ì˜ ë™ì‘ ë°©ì‹ì„ ì‚´í´ë³´ë©´ v4ë¥¼ `sha256` ì•”í˜¸í™”í•˜ì—¬ v10ì— ì €ì¥í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  `byte_13B5`ì™€ í•œ ê¸€ìì”© `XOR` í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì–´ë–¤ ê°’ì„ `sha256` ì•”í˜¸í™”í•˜ëŠ”ì§€ ì•„ì§ì€ ëª¨ë¥´ëŠ” ìƒíƒœì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ì‹œ jadxë¡œ ëŒì•„ê°€ì„œ `getdxXEPMNe`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì„ ì°¾ì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
```c
__int64 __fastcall Java_com_example_waiting_Secrets_getdxXEPMNe(__int64 a1, __int64 a2, __int64 a3)
{
  const char *v4; // x0
  unsigned __int64 i; // x23
  char v6; // w26
  unsigned __int64 v7; // x0
  _BYTE v9[52]; // [xsp+0h] [xbp-C0h] BYREF
  char v10[68]; // [xsp+34h] [xbp-8Ch] BYREF
  __int64 v11; // [xsp+78h] [xbp-48h]

  v11 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(3, 3, 13, 0, 2)) + 40);
  v4 = (const char *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + 1352LL))(a1, a3, 0LL);
  sha256(v4, v10);
  for ( i = 0LL; i != 48; ++i )
  {
    v6 = byte_13B5[i];
    v7 = __strlen_chk(v10, 0x41u);
    v9[i] = v10[i - i / v7 * v7] ^ v6;
  }
  v9[48] = 0;
  return (*(__int64 (__fastcall **)(__int64, _BYTE *))(*(_QWORD *)a1 + 1336LL))(a1, v9);
}
```
<br/>

ì•„ë˜ ì‚¬ì§„ì²˜ëŸ¼ `SecretActivity`ì—ì„œ ì‚¬ìš©í•˜ê³  `getPacakgeName` ë©”ì„œë“œë¥¼ í†µí•´ì„œ íŒ¨í‚¤ì§€ ì´ë¦„ì„ ë„˜ê²¨ì£¼ê³  ìˆìŠµë‹ˆë‹¤. ì¦‰ ì•±ì˜ íŒ¨í‚¤ì§€ ì´ë¦„ì„ `sha256` ì•”í˜¸í™” í•´ì£¼ë©´ ë˜ê² ì£ ?ğŸ™ƒ  
![flag](../../../assets/img/2023-03-12/flag.png){: w="700" h="350" }  
<br/>

# Get Flag
***
```python
from hashlib import sha256

info = lambda x : print(f"[+] {x}")
byte_13B5 =[0x71, 0x67, 0x23, 0x4A, 0x23, 0x8, 0x1, 0x1, 0x67, 0x5, 0x41, 0x41, 0x3, 0x5B, 0x51, 0x3A, 0x51, 0x5E, 0x17, 0x5C, 0x6A, 0x4D, 0x52, 0x9, 0x48, 0x57, 0x14, 0x5, 0x5A, 0x5F, 0x6A, 0x5, 0xC, 0x6, 0x5, 0xD, 0x50, 0x69, 0x5, 0x54, 0x55, 0x58, 0x51, 0x7, 0xE, 0x4B, 0x10, 0x18] 
PACKAGE_NAME = 'com.example.waiting'
FLAG =''

if __name__ == '__main__':
    sha256_encrypted = sha256(PACKAGE_NAME.encode()).hexdigest()
    for i in range(len(byte_13B5)):
        FLAG += chr(ord(sha256_encrypted[i])^byte_13B5[i])

    info(f"Flag is {FLAG}")
```
{: file='decrypt.py'}
<br/>

# ì¡ì„¤
***
ë¬¸ì œë¥¼ í’€ë©´ì„œ ì¡°ê¸ˆ ì˜ë¬¸ì´ì—ˆë˜ ì ì€ `v10[i - i / v7 * v7]` ìš” ë¶€ë¶„ì´ì—ˆëŠ”ë°, `íŒŒì´ì¬`ì—ì„œ `i-i/v7*v7`ë¥¼ ê³„ì‚°í•˜ë©´ 0ë§Œ ì¶œë ¥ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ `c`ì—ì„œëŠ” ì˜¬ë¦¼ì„ í•˜ëŠ”ì§€ 0ë¶€í„° v7-1ì„ ì¶œë ¥í•˜ì—¬ ê²°êµ­ì€ ê·¸ëƒ¥ `i`ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë„ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.ã…ã…  
```c
#include <stdio.h>

int main()
{
    for(int i=0;i<48;i++){
        printf("%d ",i-i/65*65);
    }

    return 0;
}
/* output */
/* 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 */
```
{: file='test.c'}
<br/>

ê·¸ë¦¬ê³  `Android 11(API 30)`ë¶€í„° `jarsinger`ë¡œ `apk`ì„œëª…ì„ í•˜ë©´ ì•ˆë˜ê³  `apksigner`ë¥¼ ì´ìš©í•´ì¤˜ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤. ìŠ¤ë§ë¦¬ì½”ë“œ íŒ¨ì¹˜í•˜ê³  `jarsigner`ë¡œ ì„œëª…í–ˆëŠ”ë° `API 30`ì¸ ì—ë®¬ì— ì„¤ì¹˜í•˜ë ¤ê³  í•˜ë‹ˆ ì•ˆë¼ì„œ ì°¾ì•„ë³´ë‹ˆ ì´ëŸ° ë‚´ìš©ì´ ìˆì—ˆë„¤ìš”. ìì„¸í•œ ì„¤ëª…ì€ ë˜í¼ëŸ°ìŠ¤ì˜ ë§í¬ë¥¼ í†µí•´ì„œ ë³´ì‹œë©´ ë©ë‹ˆë‹¤.  
<br/>

# Reference
***
- [https://velog.io/@seonyoung53/ionic-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-release-%EC%98%A4%EB%A5%98](https://velog.io/@seonyoung53/ionic-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-release-%EC%98%A4%EB%A5%98)